// MarkZen Main Styles - Complete Notion-Inspired Design System
// Building a modern, accessible, and performant design system

@use 'variables' as *;
@use 'mixins' as *;
@use 'sass:meta';

// =============================================================================
// NOTION DESIGN SYSTEM EXTENSIONS (works with Tailwind CSS)
// =============================================================================

// Enhanced font rendering and features
html {
  font-feature-settings: 'kern' 1, 'liga' 1, 'calt' 1;
  text-rendering: optimizeLegibility;
}

body {
  // CSS Custom Properties for dynamic theming
  --font-sans: #{meta.inspect(get($typography, fonts, sans))};
  --font-mono: #{meta.inspect(get($typography, fonts, mono))};
  --font-serif: #{meta.inspect(get($typography, fonts, serif))};
  
  // Accent colors as CSS variables
  --accent-blue: #{accent-color(blue)};
  --accent-blue-light: #{accent-color(blue-light)};
  --accent-blue-dark: #{accent-color(blue-dark)};
  --accent-green: #{accent-color(green)};
  --accent-red: #{accent-color(red)};
  --accent-orange: #{accent-color(orange)};
  --accent-purple: #{accent-color(purple)};
}

// =============================================================================
// THEME CLASSES (CSS Custom Properties for Tailwind compatibility)
// =============================================================================

// Base theme mixin that sets CSS custom properties
@mixin apply-theme($theme) {
  // Backgrounds
  --notion-bg-primary: #{color($theme, bg-primary)};
  --notion-bg-secondary: #{color($theme, bg-secondary)};
  --notion-bg-tertiary: #{color($theme, bg-tertiary)};
  --notion-bg-elevated: #{color($theme, bg-elevated)};
  
  // Text colors
  --notion-text-primary: #{color($theme, text-primary)};
  --notion-text-secondary: #{color($theme, text-secondary)};
  --notion-text-tertiary: #{color($theme, text-tertiary)};
  --notion-text-disabled: #{color($theme, text-disabled)};
  --notion-text-link: #{color($theme, text-link)};
  --notion-text-accent: #{color($theme, text-accent)};
  
  // Borders
  --notion-border-light: #{color($theme, border-light)};
  --notion-border-medium: #{color($theme, border-medium)};
  --notion-border-strong: #{color($theme, border-strong)};
  --notion-border-focus: #{color($theme, border-focus)};
  
  // Surfaces
  --notion-surface: #{color($theme, surface)};
  --notion-surface-hover: #{color($theme, surface-hover)};
  --notion-surface-active: #{color($theme, surface-active)};
  --notion-surface-selected: #{color($theme, surface-selected)};
  
  // Shadows
  --notion-shadow-sm: #{color($theme, shadow-sm)};
  --notion-shadow-md: #{color($theme, shadow-md)};
  --notion-shadow-lg: #{color($theme, shadow-lg)};
  --notion-shadow-xl: #{color($theme, shadow-xl)};
}

// Theme classes that work with Tailwind
.theme-light {
  @include apply-theme(light);
}

.theme-dark {
  @include apply-theme(dark);
}

.theme-black {
  @include apply-theme(black);
}

.theme-glass {
  @include apply-theme(glass);
  
  // Glass-specific effects
  position: relative;
  
  &::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(
      135deg,
      rgba(116, 235, 213, 0.1) 0%,
      rgba(159, 172, 230, 0.1) 25%,
      rgba(255, 206, 84, 0.1) 50%,
      rgba(252, 176, 202, 0.1) 75%,
      rgba(139, 69, 19, 0.1) 100%
    );
    background-size: 400% 400%;
    animation: gradientShift 15s ease infinite;
    pointer-events: none;
    z-index: -1;
  }
}

// Glass theme gradient animation
@keyframes gradientShift {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

// =============================================================================
// APPLICATION LAYOUT (compatible with Tailwind)
// =============================================================================

// Root container - minimal styling to work with Tailwind
#root {
  @apply h-screen w-screen overflow-hidden relative;
  isolation: isolate;
}

// Main application container
.app-container {
  @apply h-screen w-screen flex flex-col overflow-hidden;
  background-color: var(--notion-bg-primary, #ffffff);
  color: var(--notion-text-primary, #37352f);
  transition: background-color 250ms ease-out, color 250ms ease-out;
}

// =============================================================================
// NOTION-STYLE TOOLBAR (Tailwind compatible)
// =============================================================================

.toolbar {
  @apply h-14 min-h-14 flex items-center justify-between px-4 flex-shrink-0;
  background-color: var(--notion-surface, #ffffff);
  border-bottom: 1px solid var(--notion-border-light, #e9e9e7);
  backdrop-filter: blur(10px);
  z-index: 300; // Use explicit z-index value
  
  // Toolbar sections for organized layout
  .toolbar-section {
    @apply flex items-center gap-2;
  }
  
  // Visual dividers between sections
  .toolbar-divider {
    @apply w-px h-4;
    background-color: var(--notion-border-light, #e9e9e7);
    margin: 0 spacing(1);
  }
  
  // Toolbar buttons will use Tailwind classes in components
}

// =============================================================================
// MAIN CONTENT LAYOUT (Tailwind compatible)
// =============================================================================

.main-content {
  @apply flex-1 flex overflow-hidden;
  background-color: var(--notion-bg-primary, #ffffff);
  transition: all 250ms ease-out;
}

// Editor container
.editor-container {
  @apply flex-1 flex flex-col overflow-hidden relative;
  background-color: var(--notion-bg-primary, #ffffff);
  
  &.split-view {
    border-right: 1px solid var(--notion-border-light, #e9e9e7);
  }
  
  &.focus-mode {
    background-color: var(--notion-bg-secondary, #fafafa);
    
    .editor-content {
      @apply max-w-4xl mx-auto;
    }
  }
}

// Preview container
.preview-container {
  @apply flex-1 flex flex-col overflow-hidden relative;
  background-color: var(--notion-bg-secondary, #fafafa);
  border-left: 1px solid var(--notion-border-light, #e9e9e7);
  
  &.enhanced-preview {
    background-color: var(--notion-bg-elevated, #ffffff);
    
    .preview-content {
      @apply max-w-4xl mx-auto;
    }
  }
}

// =============================================================================
// EDITOR CONTENT (CodeMirror Integration)
// =============================================================================

.editor-content {
  flex: 1;
  overflow: hidden;
  position: relative;
  
  // CodeMirror container styling
  .cm-editor {
    height: 100%;
    background: transparent;
    font-family: get($typography, fonts, sans);
    font-size: get($typography, sizes, base);
    line-height: get($typography, line-heights, relaxed);
    
    // Notion-style scrolling
    .cm-scroller {
      overflow: auto !important;
      @include notion-scrollbar;
      padding: spacing(2) spacing(3);
      
      // Enhanced focus states
      &:focus-within {
        outline: none;
      }
    }
    
    // Notion-style cursor
    .cm-cursor {
      border-left-color: var(--text-accent);
      border-left-width: 2px;
    }
    
    // Selection styling
    .cm-selectionBackground {
      background-color: var(--surface-selected) !important;
    }
    
    // Line numbers (when enabled)
    .cm-lineNumbers {
      color: var(--text-tertiary);
      font-size: get($typography, sizes, sm);
    }
    
    // Active line highlight
    .cm-activeLine {
      background-color: var(--surface-hover);
    }
  }
}

// =============================================================================
// PREVIEW CONTENT (Notion-style Markdown Rendering)
// =============================================================================

.preview-content {
  flex: 1;
  overflow: auto;
  @include notion-scrollbar;
  
  // Markdown content styling
  .markdown-body {
    padding: spacing(2) spacing(3);
    max-width: none;
    font-family: get($typography, fonts, sans);
    font-size: get($typography, sizes, base);
    line-height: get($typography, line-heights, relaxed);
    color: var(--text-primary);
    
    // Headings (Notion-style hierarchy)
    h1, h2, h3, h4, h5, h6 {
      margin: spacing(8) 0 spacing(4) 0;
      font-weight: get($typography, weights, semibold);
      color: var(--text-primary);
      line-height: get($typography, line-heights, tight);
    }
    
    h1 {
      @include text('4xl');
      border-bottom: 2px solid var(--border-light);
      padding-bottom: spacing(3);
    }
    
    h2 {
      @include text('3xl');
    }
    
    h3 {
      @include text('2xl');
    }
    
    h4 {
      @include text('xl');
    }
    
    h5 {
      @include text('lg');
    }
    
    h6 {
      @include text('base');
      color: var(--text-secondary);
    }
    
    // Paragraphs
    p {
      margin: spacing(4) 0;
      line-height: get($typography, line-heights, relaxed);
    }
    
    // Lists (Notion-style)
    ul, ol {
      margin: spacing(4) 0;
      padding-left: spacing(6);
      
      li {
        margin: spacing(2) 0;
        
        // Nested lists
        ul, ol {
          margin: spacing(2) 0;
        }
      }
    }
    
    // Links (Notion-style)
    a {
      color: var(--text-link);
      text-decoration: none;
      border-bottom: 1px solid transparent;
      transition: all transition(fast) transition(ease-out);
      
      &:hover {
        border-bottom-color: var(--text-link);
      }
    }
    
    // Code (inline and blocks)
    code {
      font-family: get($typography, fonts, mono);
      font-size: 0.9em;
      background-color: var(--bg-tertiary);
      color: var(--text-primary);
      padding: spacing(0.5) spacing(1);
      border-radius: radius(sm);
      border: 1px solid var(--border-light);
    }
    
    pre {
      background-color: var(--bg-tertiary);
      border: 1px solid var(--border-light);
      border-radius: radius(md);
      padding: spacing(4);
      overflow-x: auto;
      margin: spacing(4) 0;
      @include notion-scrollbar;
      
      code {
        background: none;
        border: none;
        padding: 0;
      }
    }
    
    // Blockquotes (Notion-style)
    blockquote {
      border-left: 4px solid var(--text-accent);
      margin: spacing(4) 0;
      padding: spacing(2) 0 spacing(2) spacing(4);
      background-color: var(--surface-hover);
      color: var(--text-secondary);
      font-style: italic;
      border-radius: 0 radius(sm) radius(sm) 0;
    }
    
    // Tables (enhanced Notion-style)
    table {
      width: 100%;
      border-collapse: collapse;
      margin: spacing(4) 0;
      border: 1px solid var(--border-light);
      border-radius: radius(md);
      overflow: hidden;
      
      th, td {
        border: 1px solid var(--border-light);
        padding: spacing(2) spacing(3);
        text-align: left;
      }
      
      th {
        background-color: var(--bg-tertiary);
        font-weight: get($typography, weights, semibold);
        color: var(--text-primary);
      }
      
      tbody tr:hover {
        background-color: var(--surface-hover);
      }
    }
    
    // Images
    img {
      max-width: 100%;
      height: auto;
      border-radius: radius(md);
      margin: spacing(4) 0;
      box-shadow: shadow(sm);
    }
    
    // Horizontal rules
    hr {
      border: none;
      height: 1px;
      background-color: var(--border-light);
      margin: spacing(8) 0;
    }
  }
}

// =============================================================================
// NOTION COMPONENT STYLES
// =============================================================================

// Button Components
.btn {
  @include notion-button;
  
  &.btn-primary {
    @include notion-button('primary');
  }
  
  &.btn-secondary {
    @include notion-button('secondary');
  }
  
  &.btn-ghost {
    @include notion-button('ghost');
  }
  
  &.btn-destructive {
    @include notion-button('destructive');
  }
  
  // Size variants
  &.btn-xs {
    @include notion-button('default', 'xs');
  }
  
  &.btn-sm {
    @include notion-button('default', 'sm');
  }
  
  &.btn-lg {
    @include notion-button('default', 'lg');
  }
}

// Form Components
.input {
  @include notion-input;
  
  &.input-sm {
    @include notion-input('sm');
  }
  
  &.input-lg {
    @include notion-input('lg');
  }
}

// Card Components
.card {
  @include notion-card;
  padding: spacing(4);
  
  &.card-elevated {
    @include notion-card(true);
  }
  
  &.card-interactive {
    @include notion-card(false, true);
  }
}

// Dropdown Components
.dropdown {
  position: relative;
  
  .dropdown-trigger {
    @include notion-button('secondary');
    display: flex;
    align-items: center;
    gap: spacing(2);
  }
  
  .dropdown-menu {
    @include notion-dropdown;
    display: none;
    
    &.show {
      display: block;
      @include slide-up;
    }
  }
}

// Modal Components
.modal {
  @include notion-modal;
  display: none;
  
  &.show {
    display: flex;
    @include fade-in;
  }
}

// =============================================================================
// EDITING MODES (Typora-inspired)
// =============================================================================

// Focus Mode - Hide distractions
.focus-mode {
  .toolbar {
    opacity: 0;
    transform: translateY(-100%);
    transition: all transition(normal) transition(ease-out);
    
    &:hover {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  .editor-container {
    background-color: var(--bg-primary);
  }
  
  .preview-container {
    display: none;
  }
  
  // Center content for better focus
  .editor-content {
    display: flex;
    justify-content: center;
    
    .cm-editor {
      max-width: 800px;
      margin: 0 auto;
    }
  }
}

// Typewriter Mode - Centered scrolling
.typewriter-mode {
  .editor-content .cm-scroller {
    padding-top: 50vh;
    padding-bottom: 50vh;
  }
}

// Zen Mode - Ultimate minimalism
.zen-mode {
  .toolbar {
    display: none;
  }
  
  .editor-container {
    background-color: var(--bg-primary);
    border: none !important;
    box-shadow: none !important;
  }
  
  .editor-content {
    display: flex;
    justify-content: center;
    align-items: flex-start;
    padding-top: 2rem;
    
    .cm-editor {
      max-width: 800px;
      min-height: 400px;
      border: none !important;
      box-shadow: none !important;
      
      .cm-gutters {
        border: none !important;
      }
    }
  }
  
  // Zen mode exit hint
  &::after {
    content: 'Press ESC to exit Zen mode';
    position: fixed;
    bottom: 2rem;
    left: 50%;
    transform: translateX(-50%);
    background: var(--bg-tertiary);
    color: var(--text-secondary);
    padding: 0.75rem 1.5rem;
    border-radius: 2rem;
    font-size: 0.875rem;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
    z-index: 1000;
  }
  
  &:hover::after {
    opacity: 1;
  }
}

// =============================================================================
// UTILITY CLASSES
// =============================================================================

// Screen reader only
.sr-only {
  @include sr-only;
}

// Text truncation
.truncate {
  @include truncate;
}

// Typography utilities
.text-xs { @include text('xs'); }
.text-sm { @include text('sm'); }
.text-base { @include text('base'); }
.text-lg { @include text('lg'); }
.text-xl { @include text('xl'); }
.text-2xl { @include text('2xl'); }
.text-3xl { @include text('3xl'); }
.text-4xl { @include text('4xl'); }

// Font weights
.font-light { font-weight: get($typography, weights, light); }
.font-normal { font-weight: get($typography, weights, normal); }
.font-medium { font-weight: get($typography, weights, medium); }
.font-semibold { font-weight: get($typography, weights, semibold); }
.font-bold { font-weight: get($typography, weights, bold); }

// Layout utilities
.flex { display: flex; }
.flex-center { @include flex-center; }
.flex-between { @include flex-between; }
.flex-col { flex-direction: column; }
.flex-1 { flex: 1; }

.hidden { display: none; }
.block { display: block; }
.inline-block { display: inline-block; }

// Glass effects utilities
.glass-subtle { @include glass-subtle; }
.glass-medium { @include glass-medium; }
.glass-strong { @include glass-strong; }
.glass-button { @include glass-button; }
.glass-card { @include glass-card; }
.glass-dropdown { @include glass-dropdown; }

// =============================================================================
// ANIMATIONS & KEYFRAMES
// =============================================================================

@keyframes fadeIn {
  from { 
    opacity: 0; 
    transform: scale(0.95);
  }
  to { 
    opacity: 1; 
    transform: scale(1);
  }
}

@keyframes slideUp {
  from {
    opacity: 0;
    transform: translateY(spacing(2));
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes scaleIn {
  from {
    opacity: 0;
    transform: scale(0.9);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}

@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.5; }
}

@keyframes shimmer {
  0% { left: -100%; }
  100% { left: 100%; }
}

// Animation utility classes
.fade-in {
  @include fade-in;
}

.slide-up {
  @include slide-up;
}

// Loading States
.loading {
  position: relative;
  overflow: hidden;
  
  &::after {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(
      90deg,
      transparent,
      rgba(255, 255, 255, 0.2),
      transparent
    );
    animation: shimmer 1.5s infinite;
  }
}

// =============================================================================
// RESPONSIVE DESIGN (Mobile-first approach)
// =============================================================================

// Tablet and up
@media (max-width: get($breakpoints, md)) {
  .app-container {
    font-size: get($typography, sizes, sm);
  }
  
  .toolbar {
    padding: 0 spacing(2);
    height: 3rem;
    
    .toolbar-section {
      gap: spacing(1);
    }
    
    .toolbar-button {
      padding: spacing(1) spacing(2);
      font-size: get($typography, sizes, xs);
    }
  }
  
  .editor-content .cm-scroller,
  .preview-content .markdown-body {
    padding: spacing(4) spacing(3);
  }
  
  .main-content {
    &.mobile-stack {
      flex-direction: column;
      
      .editor-container {
        border-right: none;
        border-bottom: 1px solid var(--border-light);
      }
    }
  }
}

// Mobile devices
@media (max-width: get($breakpoints, sm)) {
  .toolbar {
    height: 2.5rem;
    padding: 0 spacing(1);
    
    .toolbar-section {
      gap: spacing(0.5);
    }
  }
  
  .editor-content .cm-scroller,
  .preview-content .markdown-body {
    padding: spacing(3) spacing(2);
  }
  
  .dropdown-menu {
    position: fixed;
    left: spacing(2);
    right: spacing(2);
    width: auto;
  }
}

// =============================================================================
// PRINT STYLES
// =============================================================================

@media print {
  // Hide interactive elements
  .toolbar,
  .dropdown,
  .modal,
  .btn {
    display: none !important;
  }
  
  // Adjust layout for print
  .app-container {
    height: auto;
    overflow: visible;
  }
  
  .main-content {
    display: block;
    height: auto;
  }
  
  .editor-container {
    display: none;
  }
  
  .preview-container {
    display: block;
    height: auto;
    overflow: visible;
  }
  
  .preview-content {
    overflow: visible;
    height: auto;
  }
  
  .markdown-body {
    color: black !important;
    background: white !important;
    font-size: 12pt;
    line-height: 1.6;
    
    h1, h2, h3, h4, h5, h6 {
      color: black !important;
      page-break-after: avoid;
    }
    
    p, li {
      orphans: 3;
      widows: 3;
    }
    
    blockquote {
      border-left: 3px solid #999;
      page-break-inside: avoid;
    }
    
    table {
      page-break-inside: avoid;
    }
    
    pre, code {
      background: #f5f5f5 !important;
      border: 1px solid #ddd;
      page-break-inside: avoid;
    }
  }
}

// =============================================================================
// HIGH CONTRAST & ACCESSIBILITY
// =============================================================================

@media (prefers-contrast: high) {
  :root {
    --border-light: #000;
    --border-medium: #000;
    --text-secondary: #000;
    --text-tertiary: #333;
  }
}

@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
  
  .theme-glass {
    animation: none;
  }
}